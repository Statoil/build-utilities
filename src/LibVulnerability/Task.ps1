Trace-VstsEnteringInvocation $MyInvocation
$projectFolder = Get-VstsInput -Name ProjectFolder -Require

try {
    $global:ErrorActionPreference = "Stop"
    $global:__vstsNoOverrideVerbose = $true
    
    Write-Host "##[command]Check-PackageVulnerability"
    $detectedVulnerabilities = Invoke-Expression -Command "$PSScriptRoot\Check-PackageVulnerability.ps1 $projectFolder"
    if ($detectedVulnerabilities -gt 0) {
        throw (New-Object System.Exception("Found $detectedVulnerabilities vulnerabilities"))
    }
}
finally {
    Trace-VstsLeavingInvocation $MyInvocation
}
